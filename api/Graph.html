---
layout: default
title: "Graph API"
categories:
  - api
---
   <div class="row-fluid">     <div class="page-title documentation-page-title">       <div class="container">         <h1 class="page-title__title">API Documentation</h1>         <a href="https://github.com/noflo/noflo/blob/master/src/lib/Graph.coffee" class="btn btn-primary page-title__button big-button">On GitHub</a>       </div>     </div>   </div>    <div class="row-fluid">     <div class="container documentation-main-container">       <div class="main">         <div class="sidebar span4">                    <nav>             <ul class="sidebar__nav">                                                                  <li>                   <a {% if page.url == '/api/ArrayPort.html' %}class="active" {% endif %}href="ArrayPort.html">                     ArrayPort                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/AsyncComponent.html' %}class="active" {% endif %}href="AsyncComponent.html">                     AsyncComponent                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/BasePort.html' %}class="active" {% endif %}href="BasePort.html">                     BasePort                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/Component.html' %}class="active" {% endif %}href="Component.html">                     Component                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/ComponentLoader.html' %}class="active" {% endif %}href="ComponentLoader.html">                     ComponentLoader                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/Graph.html' %}class="active" {% endif %}href="Graph.html">                     Graph                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/Helpers.html' %}class="active" {% endif %}href="Helpers.html">                     Helpers                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/IP.html' %}class="active" {% endif %}href="IP.html">                     IP                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/InPort.html' %}class="active" {% endif %}href="InPort.html">                     InPort                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/InternalSocket.html' %}class="active" {% endif %}href="InternalSocket.html">                     InternalSocket                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/Journal.html' %}class="active" {% endif %}href="Journal.html">                     Journal                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/Network.html' %}class="active" {% endif %}href="Network.html">                     Network                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/NoFlo.html' %}class="active" {% endif %}href="NoFlo.html">                     NoFlo                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/OutPort.html' %}class="active" {% endif %}href="OutPort.html">                     OutPort                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/Platform.html' %}class="active" {% endif %}href="Platform.html">                     Platform                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/Port.html' %}class="active" {% endif %}href="Port.html">                     Port                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/Ports.html' %}class="active" {% endif %}href="Ports.html">                     Ports                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/Streams.html' %}class="active" {% endif %}href="Streams.html">                     Streams                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/Utils.html' %}class="active" {% endif %}href="Utils.html">                     Utils                   </a>                 </li>                                             </ul>           </nav>                  </div>         <div class="content span8">           <h1>{{ page.title }}</h1>                                     <pre><code>NoFlo - Flow-Based Programming for JavaScript
(c) 2013-2014 TheGrid (Rituwall Inc.)
(c) 2011-2012 Henri Bergius, Nemein
NoFlo may be freely distributed under the MIT license
</code></pre>

<p>NoFlo graphs are Event Emitters, providing signals when the graph
definition changes.</p>                            <div class="highlight"><pre><span class="p">{</span><span class="nx">EventEmitter</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span> <span class="s1">&#39;events&#39;</span>

<span class="nx">clone</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./Utils&#39;</span><span class="p">).</span><span class="nx">clone</span>
<span class="nx">platform</span> <span class="o">=</span> <span class="nx">require</span> <span class="s1">&#39;./Platform&#39;</span></pre></div>                                                  <p>This class represents an abstract NoFlo graph containing nodes
connected to each other with edges.</p>

<p>These graphs can be used for visualization and sketching, but
also are the way to start a NoFlo network.</p>                            <div class="highlight"><pre><span class="nx">class</span> <span class="nx">Graph</span> <span class="k">extends</span> <span class="nx">EventEmitter</span>
  <span class="nv">name: </span><span class="s1">&#39;&#39;</span>
  <span class="nv">properties: </span><span class="p">{}</span>
  <span class="nv">nodes: </span><span class="p">[]</span>
  <span class="nv">edges: </span><span class="p">[]</span>
  <span class="nv">initializers: </span><span class="p">[]</span>
  <span class="nv">exports: </span><span class="p">[]</span>
  <span class="nv">inports: </span><span class="p">{}</span>
  <span class="nv">outports: </span><span class="p">{}</span>
  <span class="nv">groups: </span><span class="p">[]</span></pre></div>                                                  <h2>Creating new graphs</h2>

<p>Graphs are created by simply instantiating the Graph class
and giving it a name:</p>

<pre><code>myGraph = new Graph 'My very cool graph'
</code></pre>                            <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="p">(</span><span class="err">@</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">properties</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="err">@</span><span class="nx">nodes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="err">@</span><span class="nx">edges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="err">@</span><span class="nx">initializers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="err">@</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="err">@</span><span class="nx">inports</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="err">@</span><span class="nx">outports</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="err">@</span><span class="nx">groups</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="err">@</span><span class="nx">transaction</span> <span class="o">=</span>
      <span class="nv">id: </span><span class="kc">null</span>
      <span class="nv">depth: </span><span class="mi">0</span></pre></div>                                                  <h2>Group graph changes into transactions</h2>

<p>If no transaction is explicitly opened, each call to
the graph API will implicitly create a transaction for that change</p>                            <div class="highlight"><pre>  <span class="nv">startTransaction: </span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">metadata</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="err">@</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">id</span>
      <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Nested transactions not supported&quot;</span><span class="p">)</span>

    <span class="err">@</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span>
    <span class="err">@</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">depth</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;startTransaction&#39;</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">metadata</span>

  <span class="nv">endTransaction: </span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">metadata</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="o">not</span> <span class="err">@</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">id</span>
      <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Attempted to end non-existing transaction&quot;</span><span class="p">)</span>

    <span class="err">@</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="kc">null</span>
    <span class="err">@</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">depth</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;endTransaction&#39;</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">metadata</span>

  <span class="nv">checkTransactionStart: </span><span class="p">()</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="o">not</span> <span class="err">@</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">id</span>
      <span class="err">@</span><span class="nx">startTransaction</span> <span class="s1">&#39;implicit&#39;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="err">@</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="s1">&#39;implicit&#39;</span>
      <span class="err">@</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">depth</span> <span class="o">+=</span> <span class="mi">1</span>

  <span class="nv">checkTransactionEnd: </span><span class="p">()</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="err">@</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="s1">&#39;implicit&#39;</span>
      <span class="err">@</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">depth</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="err">@</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">depth</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="err">@</span><span class="nx">endTransaction</span> <span class="s1">&#39;implicit&#39;</span></pre></div>                                                  <h2>Modifying Graph properties</h2>

<p>This method allows changing properties of the graph.</p>                            <div class="highlight"><pre>  <span class="nv">setProperties: </span><span class="p">(</span><span class="nx">properties</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>
    <span class="nx">before</span> <span class="o">=</span> <span class="nx">clone</span> <span class="err">@</span><span class="nx">properties</span>
    <span class="k">for</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">val</span> <span class="k">of</span> <span class="nx">properties</span>
      <span class="err">@</span><span class="nx">properties</span><span class="p">[</span><span class="nx">item</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span>
    <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;changeProperties&#39;</span><span class="p">,</span> <span class="err">@</span><span class="nx">properties</span><span class="p">,</span> <span class="nx">before</span>
    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span></pre></div>                                                  <h2>Exporting a port from subgraph</h2>

<p>This allows subgraphs to expose a cleaner API by having reasonably
named ports shown instead of all the free ports of the graph</p>

<p>The ports exported using this way are ambiguous in their direciton. Use
<code>addInport</code> or <code>addOutport</code> instead to disambiguate.</p>                            <div class="highlight"><pre>  <span class="nv">addExport: </span><span class="p">(</span><span class="nx">publicPort</span><span class="p">,</span> <span class="nx">nodeKey</span><span class="p">,</span> <span class="nx">portKey</span><span class="p">,</span> <span class="nx">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="nx">x</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">y</span><span class="o">:</span><span class="mi">0</span><span class="p">})</span> <span class="o">-&gt;</span></pre></div>                                                  <p>Check that node exists</p>                            <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">unless</span> <span class="err">@</span><span class="nx">getNode</span> <span class="nx">nodeKey</span>

    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>

    <span class="nx">exported</span> <span class="o">=</span>
      <span class="nv">public: </span><span class="nx">publicPort</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
      <span class="nv">process: </span><span class="nx">nodeKey</span>
      <span class="nv">port: </span><span class="nx">portKey</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
      <span class="nv">metadata: </span><span class="nx">metadata</span>
    <span class="err">@</span><span class="nx">exports</span><span class="p">.</span><span class="nx">push</span> <span class="nx">exported</span>
    <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;addExport&#39;</span><span class="p">,</span> <span class="nx">exported</span>

    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span>

  <span class="nv">removeExport: </span><span class="p">(</span><span class="nx">publicPort</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">publicPort</span> <span class="o">=</span> <span class="nx">publicPort</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="nx">found</span> <span class="o">=</span> <span class="kc">null</span>
    <span class="k">for</span> <span class="nx">exported</span><span class="p">,</span> <span class="nx">idx</span> <span class="k">in</span> <span class="err">@</span><span class="nx">exports</span>
      <span class="nx">found</span> <span class="o">=</span> <span class="nx">exported</span> <span class="k">if</span> <span class="nx">exported</span><span class="p">.</span><span class="nx">public</span> <span class="o">is</span> <span class="nx">publicPort</span>

    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">found</span>
    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>
    <span class="err">@</span><span class="nx">exports</span><span class="p">.</span><span class="nx">splice</span> <span class="err">@</span><span class="nx">exports</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">found</span><span class="p">),</span> <span class="mi">1</span>
    <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;removeExport&#39;</span><span class="p">,</span> <span class="nx">found</span>
    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span>

  <span class="nv">addInport: </span><span class="p">(</span><span class="nx">publicPort</span><span class="p">,</span> <span class="nx">nodeKey</span><span class="p">,</span> <span class="nx">portKey</span><span class="p">,</span> <span class="nx">metadata</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>                                                  <p>Check that node exists</p>                            <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">unless</span> <span class="err">@</span><span class="nx">getNode</span> <span class="nx">nodeKey</span>

    <span class="nx">publicPort</span> <span class="o">=</span> <span class="nx">publicPort</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>
    <span class="err">@</span><span class="nx">inports</span><span class="p">[</span><span class="nx">publicPort</span><span class="p">]</span> <span class="o">=</span>
      <span class="nv">process: </span><span class="nx">nodeKey</span>
      <span class="nv">port: </span><span class="nx">portKey</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
      <span class="nv">metadata: </span><span class="nx">metadata</span>
    <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;addInport&#39;</span><span class="p">,</span> <span class="nx">publicPort</span><span class="p">,</span> <span class="err">@</span><span class="nx">inports</span><span class="p">[</span><span class="nx">publicPort</span><span class="p">]</span>
    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span>

  <span class="nv">removeInport: </span><span class="p">(</span><span class="nx">publicPort</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">publicPort</span> <span class="o">=</span> <span class="nx">publicPort</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="err">@</span><span class="nx">inports</span><span class="p">[</span><span class="nx">publicPort</span><span class="p">]</span>

    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>
    <span class="nx">port</span> <span class="o">=</span> <span class="err">@</span><span class="nx">inports</span><span class="p">[</span><span class="nx">publicPort</span><span class="p">]</span>
    <span class="err">@</span><span class="nx">setInportMetadata</span> <span class="nx">publicPort</span><span class="p">,</span> <span class="p">{}</span>
    <span class="k">delete</span> <span class="err">@</span><span class="nx">inports</span><span class="p">[</span><span class="nx">publicPort</span><span class="p">]</span>
    <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;removeInport&#39;</span><span class="p">,</span> <span class="nx">publicPort</span><span class="p">,</span> <span class="nx">port</span>
    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span>

  <span class="nv">renameInport: </span><span class="p">(</span><span class="nx">oldPort</span><span class="p">,</span> <span class="nx">newPort</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">oldPort</span> <span class="o">=</span> <span class="nx">oldPort</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="nx">newPort</span> <span class="o">=</span> <span class="nx">newPort</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="err">@</span><span class="nx">inports</span><span class="p">[</span><span class="nx">oldPort</span><span class="p">]</span>

    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>
    <span class="err">@</span><span class="nx">inports</span><span class="p">[</span><span class="nx">newPort</span><span class="p">]</span> <span class="o">=</span> <span class="err">@</span><span class="nx">inports</span><span class="p">[</span><span class="nx">oldPort</span><span class="p">]</span>
    <span class="k">delete</span> <span class="err">@</span><span class="nx">inports</span><span class="p">[</span><span class="nx">oldPort</span><span class="p">]</span>
    <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;renameInport&#39;</span><span class="p">,</span> <span class="nx">oldPort</span><span class="p">,</span> <span class="nx">newPort</span>
    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span>

  <span class="nv">setInportMetadata: </span><span class="p">(</span><span class="nx">publicPort</span><span class="p">,</span> <span class="nx">metadata</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">publicPort</span> <span class="o">=</span> <span class="nx">publicPort</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="err">@</span><span class="nx">inports</span><span class="p">[</span><span class="nx">publicPort</span><span class="p">]</span>

    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>
    <span class="nx">before</span> <span class="o">=</span> <span class="nx">clone</span> <span class="err">@</span><span class="nx">inports</span><span class="p">[</span><span class="nx">publicPort</span><span class="p">].</span><span class="nx">metadata</span>
    <span class="err">@</span><span class="nx">inports</span><span class="p">[</span><span class="nx">publicPort</span><span class="p">].</span><span class="nx">metadata</span> <span class="o">=</span> <span class="p">{}</span> <span class="nx">unless</span> <span class="err">@</span><span class="nx">inports</span><span class="p">[</span><span class="nx">publicPort</span><span class="p">].</span><span class="nx">metadata</span>
    <span class="k">for</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">val</span> <span class="k">of</span> <span class="nx">metadata</span>
      <span class="k">if</span> <span class="nx">val</span><span class="o">?</span>
        <span class="err">@</span><span class="nx">inports</span><span class="p">[</span><span class="nx">publicPort</span><span class="p">].</span><span class="nx">metadata</span><span class="p">[</span><span class="nx">item</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span>
      <span class="k">else</span>
        <span class="k">delete</span> <span class="err">@</span><span class="nx">inports</span><span class="p">[</span><span class="nx">publicPort</span><span class="p">].</span><span class="nx">metadata</span><span class="p">[</span><span class="nx">item</span><span class="p">]</span>
    <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;changeInport&#39;</span><span class="p">,</span> <span class="nx">publicPort</span><span class="p">,</span> <span class="err">@</span><span class="nx">inports</span><span class="p">[</span><span class="nx">publicPort</span><span class="p">],</span> <span class="nx">before</span>
    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span>

  <span class="nv">addOutport: </span><span class="p">(</span><span class="nx">publicPort</span><span class="p">,</span> <span class="nx">nodeKey</span><span class="p">,</span> <span class="nx">portKey</span><span class="p">,</span> <span class="nx">metadata</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>                                                  <p>Check that node exists</p>                            <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">unless</span> <span class="err">@</span><span class="nx">getNode</span> <span class="nx">nodeKey</span>

    <span class="nx">publicPort</span> <span class="o">=</span> <span class="nx">publicPort</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>
    <span class="err">@</span><span class="nx">outports</span><span class="p">[</span><span class="nx">publicPort</span><span class="p">]</span> <span class="o">=</span>
      <span class="nv">process: </span><span class="nx">nodeKey</span>
      <span class="nv">port: </span><span class="nx">portKey</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
      <span class="nv">metadata: </span><span class="nx">metadata</span>
    <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;addOutport&#39;</span><span class="p">,</span> <span class="nx">publicPort</span><span class="p">,</span> <span class="err">@</span><span class="nx">outports</span><span class="p">[</span><span class="nx">publicPort</span><span class="p">]</span>

    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span>

  <span class="nv">removeOutport: </span><span class="p">(</span><span class="nx">publicPort</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">publicPort</span> <span class="o">=</span> <span class="nx">publicPort</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="err">@</span><span class="nx">outports</span><span class="p">[</span><span class="nx">publicPort</span><span class="p">]</span>

    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>

    <span class="nx">port</span> <span class="o">=</span> <span class="err">@</span><span class="nx">outports</span><span class="p">[</span><span class="nx">publicPort</span><span class="p">]</span>
    <span class="err">@</span><span class="nx">setOutportMetadata</span> <span class="nx">publicPort</span><span class="p">,</span> <span class="p">{}</span>
    <span class="k">delete</span> <span class="err">@</span><span class="nx">outports</span><span class="p">[</span><span class="nx">publicPort</span><span class="p">]</span>
    <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;removeOutport&#39;</span><span class="p">,</span> <span class="nx">publicPort</span><span class="p">,</span> <span class="nx">port</span>

    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span>

  <span class="nv">renameOutport: </span><span class="p">(</span><span class="nx">oldPort</span><span class="p">,</span> <span class="nx">newPort</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">oldPort</span> <span class="o">=</span> <span class="nx">oldPort</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="nx">newPort</span> <span class="o">=</span> <span class="nx">newPort</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="err">@</span><span class="nx">outports</span><span class="p">[</span><span class="nx">oldPort</span><span class="p">]</span>

    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>
    <span class="err">@</span><span class="nx">outports</span><span class="p">[</span><span class="nx">newPort</span><span class="p">]</span> <span class="o">=</span> <span class="err">@</span><span class="nx">outports</span><span class="p">[</span><span class="nx">oldPort</span><span class="p">]</span>
    <span class="k">delete</span> <span class="err">@</span><span class="nx">outports</span><span class="p">[</span><span class="nx">oldPort</span><span class="p">]</span>
    <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;renameOutport&#39;</span><span class="p">,</span> <span class="nx">oldPort</span><span class="p">,</span> <span class="nx">newPort</span>
    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span>

  <span class="nv">setOutportMetadata: </span><span class="p">(</span><span class="nx">publicPort</span><span class="p">,</span> <span class="nx">metadata</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">publicPort</span> <span class="o">=</span> <span class="nx">publicPort</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="err">@</span><span class="nx">outports</span><span class="p">[</span><span class="nx">publicPort</span><span class="p">]</span>

    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>
    <span class="nx">before</span> <span class="o">=</span> <span class="nx">clone</span> <span class="err">@</span><span class="nx">outports</span><span class="p">[</span><span class="nx">publicPort</span><span class="p">].</span><span class="nx">metadata</span>
    <span class="err">@</span><span class="nx">outports</span><span class="p">[</span><span class="nx">publicPort</span><span class="p">].</span><span class="nx">metadata</span> <span class="o">=</span> <span class="p">{}</span> <span class="nx">unless</span> <span class="err">@</span><span class="nx">outports</span><span class="p">[</span><span class="nx">publicPort</span><span class="p">].</span><span class="nx">metadata</span>
    <span class="k">for</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">val</span> <span class="k">of</span> <span class="nx">metadata</span>
      <span class="k">if</span> <span class="nx">val</span><span class="o">?</span>
        <span class="err">@</span><span class="nx">outports</span><span class="p">[</span><span class="nx">publicPort</span><span class="p">].</span><span class="nx">metadata</span><span class="p">[</span><span class="nx">item</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span>
      <span class="k">else</span>
        <span class="k">delete</span> <span class="err">@</span><span class="nx">outports</span><span class="p">[</span><span class="nx">publicPort</span><span class="p">].</span><span class="nx">metadata</span><span class="p">[</span><span class="nx">item</span><span class="p">]</span>
    <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;changeOutport&#39;</span><span class="p">,</span> <span class="nx">publicPort</span><span class="p">,</span> <span class="err">@</span><span class="nx">outports</span><span class="p">[</span><span class="nx">publicPort</span><span class="p">],</span> <span class="nx">before</span>
    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span></pre></div>                                                  <h2>Grouping nodes in a graph</h2>                            <div class="highlight"><pre>  <span class="nv">addGroup: </span><span class="p">(</span><span class="nx">group</span><span class="p">,</span> <span class="nx">nodes</span><span class="p">,</span> <span class="nx">metadata</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>

    <span class="nx">g</span> <span class="o">=</span>
      <span class="nv">name: </span><span class="nx">group</span>
      <span class="nv">nodes: </span><span class="nx">nodes</span>
      <span class="nv">metadata: </span><span class="nx">metadata</span>
    <span class="err">@</span><span class="nx">groups</span><span class="p">.</span><span class="nx">push</span> <span class="nx">g</span>
    <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;addGroup&#39;</span><span class="p">,</span> <span class="nx">g</span>

    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span>

  <span class="nv">renameGroup: </span><span class="p">(</span><span class="nx">oldName</span><span class="p">,</span> <span class="nx">newName</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">group</span> <span class="k">in</span> <span class="err">@</span><span class="nx">groups</span>
      <span class="k">continue</span> <span class="nx">unless</span> <span class="nx">group</span>
      <span class="k">continue</span> <span class="nx">unless</span> <span class="nx">group</span><span class="p">.</span><span class="nx">name</span> <span class="o">is</span> <span class="nx">oldName</span>
      <span class="nx">group</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">newName</span>
      <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;renameGroup&#39;</span><span class="p">,</span> <span class="nx">oldName</span><span class="p">,</span> <span class="nx">newName</span>
    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span>

  <span class="nv">removeGroup: </span><span class="p">(</span><span class="nx">groupName</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>

    <span class="k">for</span> <span class="nx">group</span> <span class="k">in</span> <span class="err">@</span><span class="nx">groups</span>
      <span class="k">continue</span> <span class="nx">unless</span> <span class="nx">group</span>
      <span class="k">continue</span> <span class="nx">unless</span> <span class="nx">group</span><span class="p">.</span><span class="nx">name</span> <span class="o">is</span> <span class="nx">groupName</span>
      <span class="err">@</span><span class="nx">setGroupMetadata</span> <span class="nx">group</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="p">{}</span>
      <span class="err">@</span><span class="nx">groups</span><span class="p">.</span><span class="nx">splice</span> <span class="err">@</span><span class="nx">groups</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">group</span><span class="p">),</span> <span class="mi">1</span>
      <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;removeGroup&#39;</span><span class="p">,</span> <span class="nx">group</span>

    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span>

  <span class="nv">setGroupMetadata: </span><span class="p">(</span><span class="nx">groupName</span><span class="p">,</span> <span class="nx">metadata</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">group</span> <span class="k">in</span> <span class="err">@</span><span class="nx">groups</span>
      <span class="k">continue</span> <span class="nx">unless</span> <span class="nx">group</span>
      <span class="k">continue</span> <span class="nx">unless</span> <span class="nx">group</span><span class="p">.</span><span class="nx">name</span> <span class="o">is</span> <span class="nx">groupName</span>
      <span class="nx">before</span> <span class="o">=</span> <span class="nx">clone</span> <span class="nx">group</span><span class="p">.</span><span class="nx">metadata</span>
      <span class="k">for</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">val</span> <span class="k">of</span> <span class="nx">metadata</span>
        <span class="k">if</span> <span class="nx">val</span><span class="o">?</span>
          <span class="nx">group</span><span class="p">.</span><span class="nx">metadata</span><span class="p">[</span><span class="nx">item</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span>
        <span class="k">else</span>
          <span class="k">delete</span> <span class="nx">group</span><span class="p">.</span><span class="nx">metadata</span><span class="p">[</span><span class="nx">item</span><span class="p">]</span>
      <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;changeGroup&#39;</span><span class="p">,</span> <span class="nx">group</span><span class="p">,</span> <span class="nx">before</span>
    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span></pre></div>                                                  <h2>Adding a node to the graph</h2>

<p>Nodes are identified by an ID unique to the graph. Additionally,
a node may contain information on what NoFlo component it is and
possible display coordinates.</p>

<p>For example:</p>

<pre><code>myGraph.addNode 'Read, 'ReadFile',
  x: 91
  y: 154
</code></pre>

<p>Addition of a node will emit the <code>addNode</code> event.</p>                            <div class="highlight"><pre>  <span class="nv">addNode: </span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">component</span><span class="p">,</span> <span class="nx">metadata</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>

    <span class="nx">metadata</span> <span class="o">=</span> <span class="p">{}</span> <span class="nx">unless</span> <span class="nx">metadata</span>
    <span class="nx">node</span> <span class="o">=</span>
      <span class="nv">id: </span><span class="nx">id</span>
      <span class="nv">component: </span><span class="nx">component</span>
      <span class="nv">metadata: </span><span class="nx">metadata</span>
    <span class="err">@</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">push</span> <span class="nx">node</span>
    <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;addNode&#39;</span><span class="p">,</span> <span class="nx">node</span>

    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span>
    <span class="nx">node</span></pre></div>                                                  <h2>Removing a node from the graph</h2>

<p>Existing nodes can be removed from a graph by their ID. This
will remove the node and also remove all edges connected to it.</p>

<pre><code>myGraph.removeNode 'Read'
</code></pre>

<p>Once the node has been removed, the <code>removeNode</code> event will be
emitted.</p>                            <div class="highlight"><pre>  <span class="nv">removeNode: </span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">node</span> <span class="o">=</span> <span class="err">@</span><span class="nx">getNode</span> <span class="nx">id</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">node</span>

    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>

    <span class="nx">toRemove</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="nx">edge</span> <span class="k">in</span> <span class="err">@</span><span class="nx">edges</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">node</span> <span class="o">is</span> <span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="o">or</span> <span class="p">(</span><span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span> <span class="o">is</span> <span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
        <span class="nx">toRemove</span><span class="p">.</span><span class="nx">push</span> <span class="nx">edge</span>
    <span class="k">for</span> <span class="nx">edge</span> <span class="k">in</span> <span class="nx">toRemove</span>
      <span class="err">@</span><span class="nx">removeEdge</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">port</span><span class="p">,</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">port</span>

    <span class="nx">toRemove</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="nx">initializer</span> <span class="k">in</span> <span class="err">@</span><span class="nx">initializers</span>
      <span class="k">if</span> <span class="nx">initializer</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span> <span class="o">is</span> <span class="nx">node</span><span class="p">.</span><span class="nx">id</span>
        <span class="nx">toRemove</span><span class="p">.</span><span class="nx">push</span> <span class="nx">initializer</span>
    <span class="k">for</span> <span class="nx">initializer</span> <span class="k">in</span> <span class="nx">toRemove</span>
      <span class="err">@</span><span class="nx">removeInitial</span> <span class="nx">initializer</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">initializer</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">port</span>

    <span class="nx">toRemove</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="nx">exported</span> <span class="k">in</span> <span class="err">@</span><span class="nx">exports</span>
      <span class="k">if</span> <span class="nx">id</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">is</span> <span class="nx">exported</span><span class="p">.</span><span class="nx">process</span>
        <span class="nx">toRemove</span><span class="p">.</span><span class="nx">push</span> <span class="nx">exported</span>
    <span class="k">for</span> <span class="nx">exported</span> <span class="k">in</span> <span class="nx">toRemove</span>
      <span class="err">@</span><span class="nx">removeExport</span> <span class="nx">exported</span><span class="p">.</span><span class="nx">public</span>

    <span class="nx">toRemove</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="nx">pub</span><span class="p">,</span> <span class="nx">priv</span> <span class="k">of</span> <span class="err">@</span><span class="nx">inports</span>
      <span class="k">if</span> <span class="nx">priv</span><span class="p">.</span><span class="nx">process</span> <span class="o">is</span> <span class="nx">id</span>
        <span class="nx">toRemove</span><span class="p">.</span><span class="nx">push</span> <span class="nx">pub</span>
    <span class="k">for</span> <span class="nx">pub</span> <span class="k">in</span> <span class="nx">toRemove</span>
      <span class="err">@</span><span class="nx">removeInport</span> <span class="nx">pub</span>

    <span class="nx">toRemove</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="nx">pub</span><span class="p">,</span> <span class="nx">priv</span> <span class="k">of</span> <span class="err">@</span><span class="nx">outports</span>
      <span class="k">if</span> <span class="nx">priv</span><span class="p">.</span><span class="nx">process</span> <span class="o">is</span> <span class="nx">id</span>
        <span class="nx">toRemove</span><span class="p">.</span><span class="nx">push</span> <span class="nx">pub</span>
    <span class="k">for</span> <span class="nx">pub</span> <span class="k">in</span> <span class="nx">toRemove</span>
      <span class="err">@</span><span class="nx">removeOutport</span> <span class="nx">pub</span>

    <span class="k">for</span> <span class="nx">group</span> <span class="k">in</span> <span class="err">@</span><span class="nx">groups</span>
      <span class="k">continue</span> <span class="nx">unless</span> <span class="nx">group</span>
      <span class="nx">index</span> <span class="o">=</span> <span class="nx">group</span><span class="p">.</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
      <span class="k">continue</span> <span class="k">if</span> <span class="nx">index</span> <span class="o">is</span> <span class="o">-</span><span class="mi">1</span>
      <span class="nx">group</span><span class="p">.</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">splice</span> <span class="nx">index</span><span class="p">,</span> <span class="mi">1</span>

    <span class="err">@</span><span class="nx">setNodeMetadata</span> <span class="nx">id</span><span class="p">,</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="o">-</span><span class="mi">1</span> <span class="o">isnt</span> <span class="err">@</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">indexOf</span> <span class="nx">node</span>
      <span class="err">@</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">splice</span> <span class="err">@</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span> <span class="mi">1</span>

    <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;removeNode&#39;</span><span class="p">,</span> <span class="nx">node</span>

    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span></pre></div>                                                  <h2>Getting a node</h2>

<p>Nodes objects can be retrieved from the graph by their ID:</p>

<pre><code>myNode = myGraph.getNode 'Read'
</code></pre>                            <div class="highlight"><pre>  <span class="nv">getNode: </span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">for</span> <span class="nx">node</span> <span class="k">in</span> <span class="err">@</span><span class="nx">nodes</span>
      <span class="k">continue</span> <span class="nx">unless</span> <span class="nx">node</span>
      <span class="k">return</span> <span class="nx">node</span> <span class="k">if</span> <span class="nx">node</span><span class="p">.</span><span class="nx">id</span> <span class="o">is</span> <span class="nx">id</span>
    <span class="k">return</span> <span class="kc">null</span></pre></div>                                                  <h2>Renaming a node</h2>

<p>Nodes IDs can be changed by calling this method.</p>                            <div class="highlight"><pre>  <span class="nv">renameNode: </span><span class="p">(</span><span class="nx">oldId</span><span class="p">,</span> <span class="nx">newId</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>

    <span class="nx">node</span> <span class="o">=</span> <span class="err">@</span><span class="nx">getNode</span> <span class="nx">oldId</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">node</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">newId</span>

    <span class="k">for</span> <span class="nx">edge</span> <span class="k">in</span> <span class="err">@</span><span class="nx">edges</span>
      <span class="k">continue</span> <span class="nx">unless</span> <span class="nx">edge</span>
      <span class="k">if</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">node</span> <span class="o">is</span> <span class="nx">oldId</span>
        <span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">node</span> <span class="o">=</span> <span class="nx">newId</span>
      <span class="k">if</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span> <span class="o">is</span> <span class="nx">oldId</span>
        <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span> <span class="o">=</span> <span class="nx">newId</span>

    <span class="k">for</span> <span class="nx">iip</span> <span class="k">in</span> <span class="err">@</span><span class="nx">initializers</span>
      <span class="k">continue</span> <span class="nx">unless</span> <span class="nx">iip</span>
      <span class="k">if</span> <span class="nx">iip</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span> <span class="o">is</span> <span class="nx">oldId</span>
        <span class="nx">iip</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span> <span class="o">=</span> <span class="nx">newId</span>

    <span class="k">for</span> <span class="nx">pub</span><span class="p">,</span> <span class="nx">priv</span> <span class="k">of</span> <span class="err">@</span><span class="nx">inports</span>
      <span class="k">if</span> <span class="nx">priv</span><span class="p">.</span><span class="nx">process</span> <span class="o">is</span> <span class="nx">oldId</span>
        <span class="nx">priv</span><span class="p">.</span><span class="nx">process</span> <span class="o">=</span> <span class="nx">newId</span>
    <span class="k">for</span> <span class="nx">pub</span><span class="p">,</span> <span class="nx">priv</span> <span class="k">of</span> <span class="err">@</span><span class="nx">outports</span>
      <span class="k">if</span> <span class="nx">priv</span><span class="p">.</span><span class="nx">process</span> <span class="o">is</span> <span class="nx">oldId</span>
        <span class="nx">priv</span><span class="p">.</span><span class="nx">process</span> <span class="o">=</span> <span class="nx">newId</span>
    <span class="k">for</span> <span class="nx">exported</span> <span class="k">in</span> <span class="err">@</span><span class="nx">exports</span>
      <span class="k">if</span> <span class="nx">exported</span><span class="p">.</span><span class="nx">process</span> <span class="o">is</span> <span class="nx">oldId</span>
        <span class="nx">exported</span><span class="p">.</span><span class="nx">process</span> <span class="o">=</span> <span class="nx">newId</span>

    <span class="k">for</span> <span class="nx">group</span> <span class="k">in</span> <span class="err">@</span><span class="nx">groups</span>
      <span class="k">continue</span> <span class="nx">unless</span> <span class="nx">group</span>
      <span class="nx">index</span> <span class="o">=</span> <span class="nx">group</span><span class="p">.</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">oldId</span><span class="p">)</span>
      <span class="k">continue</span> <span class="k">if</span> <span class="nx">index</span> <span class="o">is</span> <span class="o">-</span><span class="mi">1</span>
      <span class="nx">group</span><span class="p">.</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="nx">newId</span>

    <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;renameNode&#39;</span><span class="p">,</span> <span class="nx">oldId</span><span class="p">,</span> <span class="nx">newId</span>
    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span></pre></div>                                                  <h2>Changing a node's metadata</h2>

<p>Node metadata can be set or changed by calling this method.</p>                            <div class="highlight"><pre>  <span class="nv">setNodeMetadata: </span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">metadata</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">node</span> <span class="o">=</span> <span class="err">@</span><span class="nx">getNode</span> <span class="nx">id</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">node</span>

    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>

    <span class="nx">before</span> <span class="o">=</span> <span class="nx">clone</span> <span class="nx">node</span><span class="p">.</span><span class="nx">metadata</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">metadata</span> <span class="o">=</span> <span class="p">{}</span> <span class="nx">unless</span> <span class="nx">node</span><span class="p">.</span><span class="nx">metadata</span>

    <span class="k">for</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">val</span> <span class="k">of</span> <span class="nx">metadata</span>
      <span class="k">if</span> <span class="nx">val</span><span class="o">?</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">metadata</span><span class="p">[</span><span class="nx">item</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span>
      <span class="k">else</span>
        <span class="k">delete</span> <span class="nx">node</span><span class="p">.</span><span class="nx">metadata</span><span class="p">[</span><span class="nx">item</span><span class="p">]</span>

    <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;changeNode&#39;</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">before</span>
    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span></pre></div>                                                  <h2>Connecting nodes</h2>

<p>Nodes can be connected by adding edges between a node's outport
and another node's inport:</p>

<pre><code>myGraph.addEdge 'Read', 'out', 'Display', 'in'
myGraph.addEdgeIndex 'Read', 'out', null, 'Display', 'in', 2
</code></pre>

<p>Adding an edge will emit the <code>addEdge</code> event.</p>                            <div class="highlight"><pre>  <span class="nv">addEdge: </span><span class="p">(</span><span class="nx">outNode</span><span class="p">,</span> <span class="nx">outPort</span><span class="p">,</span> <span class="nx">inNode</span><span class="p">,</span> <span class="nx">inPort</span><span class="p">,</span> <span class="nx">metadata</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">-&gt;</span>
    <span class="nx">outPort</span> <span class="o">=</span> <span class="nx">outPort</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="nx">inPort</span> <span class="o">=</span> <span class="nx">inPort</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">edge</span> <span class="k">in</span> <span class="err">@</span><span class="nx">edges</span></pre></div>                                                  <p>don't add a duplicate edge</p>                            <div class="highlight"><pre>      <span class="k">return</span> <span class="k">if</span> <span class="p">(</span><span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">node</span> <span class="o">is</span> <span class="nx">outNode</span> <span class="o">and</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">port</span> <span class="o">is</span> <span class="nx">outPort</span> <span class="o">and</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span> <span class="o">is</span> <span class="nx">inNode</span> <span class="o">and</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">port</span> <span class="o">is</span> <span class="nx">inPort</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="err">@</span><span class="nx">getNode</span> <span class="nx">outNode</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="err">@</span><span class="nx">getNode</span> <span class="nx">inNode</span>

    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>

    <span class="nx">edge</span> <span class="o">=</span>
      <span class="nv">from:</span>
        <span class="nv">node: </span><span class="nx">outNode</span>
        <span class="nv">port: </span><span class="nx">outPort</span>
      <span class="nv">to:</span>
        <span class="nv">node: </span><span class="nx">inNode</span>
        <span class="nv">port: </span><span class="nx">inPort</span>
      <span class="nv">metadata: </span><span class="nx">metadata</span>
    <span class="err">@</span><span class="nx">edges</span><span class="p">.</span><span class="nx">push</span> <span class="nx">edge</span>
    <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;addEdge&#39;</span><span class="p">,</span> <span class="nx">edge</span>

    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span>
    <span class="nx">edge</span></pre></div>                                                  <p>Adding an edge will emit the <code>addEdge</code> event.</p>                            <div class="highlight"><pre>  <span class="nv">addEdgeIndex: </span><span class="p">(</span><span class="nx">outNode</span><span class="p">,</span> <span class="nx">outPort</span><span class="p">,</span> <span class="nx">outIndex</span><span class="p">,</span> <span class="nx">inNode</span><span class="p">,</span> <span class="nx">inPort</span><span class="p">,</span> <span class="nx">inIndex</span><span class="p">,</span> <span class="nx">metadata</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">-&gt;</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="err">@</span><span class="nx">getNode</span> <span class="nx">outNode</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="err">@</span><span class="nx">getNode</span> <span class="nx">inNode</span>

    <span class="nx">outPort</span> <span class="o">=</span> <span class="nx">outPort</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="nx">inPort</span> <span class="o">=</span> <span class="nx">inPort</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>

    <span class="nx">inIndex</span> <span class="o">=</span> <span class="kc">undefined</span> <span class="k">if</span> <span class="nx">inIndex</span> <span class="o">is</span> <span class="kc">null</span>
    <span class="nx">outIndex</span> <span class="o">=</span> <span class="kc">undefined</span> <span class="k">if</span> <span class="nx">outIndex</span> <span class="o">is</span> <span class="kc">null</span>
    <span class="nx">metadata</span> <span class="o">=</span> <span class="p">{}</span> <span class="nx">unless</span> <span class="nx">metadata</span>

    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>

    <span class="nx">edge</span> <span class="o">=</span>
      <span class="nv">from:</span>
        <span class="nv">node: </span><span class="nx">outNode</span>
        <span class="nv">port: </span><span class="nx">outPort</span>
        <span class="nv">index: </span><span class="nx">outIndex</span>
      <span class="nv">to:</span>
        <span class="nv">node: </span><span class="nx">inNode</span>
        <span class="nv">port: </span><span class="nx">inPort</span>
        <span class="nv">index: </span><span class="nx">inIndex</span>
      <span class="nv">metadata: </span><span class="nx">metadata</span>
    <span class="err">@</span><span class="nx">edges</span><span class="p">.</span><span class="nx">push</span> <span class="nx">edge</span>
    <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;addEdge&#39;</span><span class="p">,</span> <span class="nx">edge</span>

    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span>
    <span class="nx">edge</span></pre></div>                                                  <h2>Disconnected nodes</h2>

<p>Connections between nodes can be removed by providing the
nodes and ports to disconnect.</p>

<pre><code>myGraph.removeEdge 'Display', 'out', 'Foo', 'in'
</code></pre>

<p>Removing a connection will emit the <code>removeEdge</code> event.</p>                            <div class="highlight"><pre>  <span class="nv">removeEdge: </span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">port</span><span class="p">,</span> <span class="nx">node2</span><span class="p">,</span> <span class="nx">port2</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>
    <span class="nx">port</span> <span class="o">=</span> <span class="nx">port</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="nx">port2</span> <span class="o">=</span> <span class="nx">port2</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="nx">toRemove</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="nx">toKeep</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nx">node2</span> <span class="o">and</span> <span class="nx">port2</span>
      <span class="k">for</span> <span class="nx">edge</span><span class="p">,</span><span class="nx">index</span> <span class="k">in</span> <span class="err">@</span><span class="nx">edges</span>
        <span class="k">if</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">node</span> <span class="o">is</span> <span class="nx">node</span> <span class="o">and</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">port</span> <span class="o">is</span> <span class="nx">port</span> <span class="o">and</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span> <span class="o">is</span> <span class="nx">node2</span> <span class="o">and</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">port</span> <span class="o">is</span> <span class="nx">port2</span>
          <span class="err">@</span><span class="nx">setEdgeMetadata</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">port</span><span class="p">,</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">port</span><span class="p">,</span> <span class="p">{}</span>
          <span class="nx">toRemove</span><span class="p">.</span><span class="nx">push</span> <span class="nx">edge</span>
        <span class="k">else</span>
          <span class="nx">toKeep</span><span class="p">.</span><span class="nx">push</span> <span class="nx">edge</span>
    <span class="k">else</span>
      <span class="k">for</span> <span class="nx">edge</span><span class="p">,</span><span class="nx">index</span> <span class="k">in</span> <span class="err">@</span><span class="nx">edges</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">node</span> <span class="o">is</span> <span class="nx">node</span> <span class="o">and</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">port</span> <span class="o">is</span> <span class="nx">port</span><span class="p">)</span> <span class="o">or</span> <span class="p">(</span><span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span> <span class="o">is</span> <span class="nx">node</span> <span class="o">and</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">port</span> <span class="o">is</span> <span class="nx">port</span><span class="p">)</span>
          <span class="err">@</span><span class="nx">setEdgeMetadata</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">port</span><span class="p">,</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">port</span><span class="p">,</span> <span class="p">{}</span>
          <span class="nx">toRemove</span><span class="p">.</span><span class="nx">push</span> <span class="nx">edge</span>
        <span class="k">else</span>
          <span class="nx">toKeep</span><span class="p">.</span><span class="nx">push</span> <span class="nx">edge</span>

    <span class="err">@</span><span class="nx">edges</span> <span class="o">=</span> <span class="nx">toKeep</span>
    <span class="k">for</span> <span class="nx">edge</span> <span class="k">in</span> <span class="nx">toRemove</span>
      <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;removeEdge&#39;</span><span class="p">,</span> <span class="nx">edge</span>

    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span></pre></div>                                                  <h2>Getting an edge</h2>

<p>Edge objects can be retrieved from the graph by the node and port IDs:</p>

<pre><code>myEdge = myGraph.getEdge 'Read', 'out', 'Write', 'in'
</code></pre>                            <div class="highlight"><pre>  <span class="nv">getEdge: </span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">port</span><span class="p">,</span> <span class="nx">node2</span><span class="p">,</span> <span class="nx">port2</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">port</span> <span class="o">=</span> <span class="nx">port</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="nx">port2</span> <span class="o">=</span> <span class="nx">port2</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="k">for</span> <span class="nx">edge</span><span class="p">,</span><span class="nx">index</span> <span class="k">in</span> <span class="err">@</span><span class="nx">edges</span>
      <span class="k">continue</span> <span class="nx">unless</span> <span class="nx">edge</span>
      <span class="k">if</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">node</span> <span class="o">is</span> <span class="nx">node</span> <span class="o">and</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">port</span> <span class="o">is</span> <span class="nx">port</span>
        <span class="k">if</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span> <span class="o">is</span> <span class="nx">node2</span> <span class="o">and</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">port</span> <span class="o">is</span> <span class="nx">port2</span>
          <span class="k">return</span> <span class="nx">edge</span>
    <span class="k">return</span> <span class="kc">null</span></pre></div>                                                  <h2>Changing an edge's metadata</h2>

<p>Edge metadata can be set or changed by calling this method.</p>                            <div class="highlight"><pre>  <span class="nv">setEdgeMetadata: </span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">port</span><span class="p">,</span> <span class="nx">node2</span><span class="p">,</span> <span class="nx">port2</span><span class="p">,</span> <span class="nx">metadata</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">edge</span> <span class="o">=</span> <span class="err">@</span><span class="nx">getEdge</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">port</span><span class="p">,</span> <span class="nx">node2</span><span class="p">,</span> <span class="nx">port2</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">edge</span>

    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>
    <span class="nx">before</span> <span class="o">=</span> <span class="nx">clone</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">metadata</span>
    <span class="nx">edge</span><span class="p">.</span><span class="nx">metadata</span> <span class="o">=</span> <span class="p">{}</span> <span class="nx">unless</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">metadata</span>

    <span class="k">for</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">val</span> <span class="k">of</span> <span class="nx">metadata</span>
      <span class="k">if</span> <span class="nx">val</span><span class="o">?</span>
        <span class="nx">edge</span><span class="p">.</span><span class="nx">metadata</span><span class="p">[</span><span class="nx">item</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span>
      <span class="k">else</span>
        <span class="k">delete</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">metadata</span><span class="p">[</span><span class="nx">item</span><span class="p">]</span>

    <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;changeEdge&#39;</span><span class="p">,</span> <span class="nx">edge</span><span class="p">,</span> <span class="nx">before</span>
    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span></pre></div>                                                  <h2>Adding Initial Information Packets</h2>

<p>Initial Information Packets (IIPs) can be used for sending data
to specified node inports without a sending node instance.</p>

<p>IIPs are especially useful for sending configuration information
to components at NoFlo network start-up time. This could include
filenames to read, or network ports to listen to.</p>

<pre><code>myGraph.addInitial 'somefile.txt', 'Read', 'source'
myGraph.addInitialIndex 'somefile.txt', 'Read', 'source', 2
</code></pre>

<p>If inports are defined on the graph, IIPs can be applied calling
the <code>addGraphInitial</code> or <code>addGraphInitialIndex</code> methods.</p>

<pre><code>myGraph.addGraphInitial 'somefile.txt', 'file'
myGraph.addGraphInitialIndex 'somefile.txt', 'file', 2
</code></pre>

<p>Adding an IIP will emit a <code>addInitial</code> event.</p>                            <div class="highlight"><pre>  <span class="nv">addInitial: </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">port</span><span class="p">,</span> <span class="nx">metadata</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="err">@</span><span class="nx">getNode</span> <span class="nx">node</span>

    <span class="nx">port</span> <span class="o">=</span> <span class="nx">port</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>
    <span class="nx">initializer</span> <span class="o">=</span>
      <span class="nv">from:</span>
        <span class="nv">data: </span><span class="nx">data</span>
      <span class="nv">to:</span>
        <span class="nv">node: </span><span class="nx">node</span>
        <span class="nv">port: </span><span class="nx">port</span>
      <span class="nv">metadata: </span><span class="nx">metadata</span>
    <span class="err">@</span><span class="nx">initializers</span><span class="p">.</span><span class="nx">push</span> <span class="nx">initializer</span>
    <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;addInitial&#39;</span><span class="p">,</span> <span class="nx">initializer</span>

    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span>
    <span class="nx">initializer</span>

  <span class="nv">addInitialIndex: </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">port</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">metadata</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="err">@</span><span class="nx">getNode</span> <span class="nx">node</span>
    <span class="nx">index</span> <span class="o">=</span> <span class="kc">undefined</span> <span class="k">if</span> <span class="nx">index</span> <span class="o">is</span> <span class="kc">null</span>

    <span class="nx">port</span> <span class="o">=</span> <span class="nx">port</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>
    <span class="nx">initializer</span> <span class="o">=</span>
      <span class="nv">from:</span>
        <span class="nv">data: </span><span class="nx">data</span>
      <span class="nv">to:</span>
        <span class="nv">node: </span><span class="nx">node</span>
        <span class="nv">port: </span><span class="nx">port</span>
        <span class="nv">index: </span><span class="nx">index</span>
      <span class="nv">metadata: </span><span class="nx">metadata</span>
    <span class="err">@</span><span class="nx">initializers</span><span class="p">.</span><span class="nx">push</span> <span class="nx">initializer</span>
    <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;addInitial&#39;</span><span class="p">,</span> <span class="nx">initializer</span>

    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span>
    <span class="nx">initializer</span>

  <span class="nv">addGraphInitial: </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">metadata</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">inport</span> <span class="o">=</span> <span class="err">@</span><span class="nx">inports</span><span class="p">[</span><span class="nx">node</span><span class="p">]</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">inport</span>
    <span class="err">@</span><span class="nx">addInitial</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">inport</span><span class="p">.</span><span class="nx">process</span><span class="p">,</span> <span class="nx">inport</span><span class="p">.</span><span class="nx">port</span><span class="p">,</span> <span class="nx">metadata</span>

  <span class="nv">addGraphInitialIndex: </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">metadata</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">inport</span> <span class="o">=</span> <span class="err">@</span><span class="nx">inports</span><span class="p">[</span><span class="nx">node</span><span class="p">]</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">inport</span>
    <span class="err">@</span><span class="nx">addInitialIndex</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">inport</span><span class="p">.</span><span class="nx">process</span><span class="p">,</span> <span class="nx">inport</span><span class="p">.</span><span class="nx">port</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">metadata</span></pre></div>                                                  <h2>Removing Initial Information Packets</h2>

<p>IIPs can be removed by calling the <code>removeInitial</code> method.</p>

<pre><code>myGraph.removeInitial 'Read', 'source'
</code></pre>

<p>If the IIP was applied via the <code>addGraphInitial</code> or
<code>addGraphInitialIndex</code> functions, it can be removed using
the <code>removeGraphInitial</code> method.</p>

<pre><code>myGraph.removeGraphInitial 'file'
</code></pre>

<p>Remove an IIP will emit a <code>removeInitial</code> event.</p>                            <div class="highlight"><pre>  <span class="nv">removeInitial: </span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">port</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">port</span> <span class="o">=</span> <span class="nx">port</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
    <span class="err">@</span><span class="nx">checkTransactionStart</span><span class="p">()</span>

    <span class="nx">toRemove</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="nx">toKeep</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="nx">edge</span><span class="p">,</span> <span class="nx">index</span> <span class="k">in</span> <span class="err">@</span><span class="nx">initializers</span>
      <span class="k">if</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span> <span class="o">is</span> <span class="nx">node</span> <span class="o">and</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">port</span> <span class="o">is</span> <span class="nx">port</span>
        <span class="nx">toRemove</span><span class="p">.</span><span class="nx">push</span> <span class="nx">edge</span>
      <span class="k">else</span>
        <span class="nx">toKeep</span><span class="p">.</span><span class="nx">push</span> <span class="nx">edge</span>
    <span class="err">@</span><span class="nx">initializers</span> <span class="o">=</span> <span class="nx">toKeep</span>
    <span class="k">for</span> <span class="nx">edge</span> <span class="k">in</span> <span class="nx">toRemove</span>
      <span class="err">@</span><span class="nx">emit</span> <span class="s1">&#39;removeInitial&#39;</span><span class="p">,</span> <span class="nx">edge</span>

    <span class="err">@</span><span class="nx">checkTransactionEnd</span><span class="p">()</span>

  <span class="nv">removeGraphInitial: </span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">inport</span> <span class="o">=</span> <span class="err">@</span><span class="nx">inports</span><span class="p">[</span><span class="nx">node</span><span class="p">]</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">inport</span>
    <span class="err">@</span><span class="nx">removeInitial</span> <span class="nx">inport</span><span class="p">.</span><span class="nx">process</span><span class="p">,</span> <span class="nx">inport</span><span class="p">.</span><span class="nx">port</span>

  <span class="nv">toDOT: </span><span class="o">-&gt;</span>
    <span class="nx">cleanID</span> <span class="o">=</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="o">-&gt;</span>
      <span class="nx">id</span><span class="p">.</span><span class="nx">replace</span> <span class="o">/</span><span class="err">\</span><span class="nx">s</span><span class="o">*</span><span class="err">/g, &quot;&quot;</span>
    <span class="nx">cleanPort</span> <span class="o">=</span> <span class="p">(</span><span class="nx">port</span><span class="p">)</span> <span class="o">-&gt;</span>
      <span class="nx">port</span><span class="p">.</span><span class="nx">replace</span> <span class="o">/</span><span class="err">\</span><span class="p">.</span><span class="o">/</span><span class="nx">g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>

    <span class="nx">dot</span> <span class="o">=</span> <span class="s2">&quot;digraph {\n&quot;</span>

    <span class="k">for</span> <span class="nx">node</span> <span class="k">in</span> <span class="err">@</span><span class="nx">nodes</span>
      <span class="nx">dot</span> <span class="o">+=</span> <span class="s2">&quot;    #{cleanID(node.id)} [label=#{node.id} shape=box]\n&quot;</span>

    <span class="k">for</span> <span class="nx">initializer</span><span class="p">,</span> <span class="nx">id</span> <span class="k">in</span> <span class="err">@</span><span class="nx">initializers</span>
      <span class="k">if</span> <span class="k">typeof</span> <span class="nx">initializer</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">data</span> <span class="o">is</span> <span class="s1">&#39;function&#39;</span>
        <span class="nx">data</span> <span class="o">=</span> <span class="s1">&#39;Function&#39;</span>
      <span class="k">else</span>
        <span class="nx">data</span> <span class="o">=</span> <span class="nx">initializer</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">data</span>
      <span class="nx">dot</span> <span class="o">+=</span> <span class="s2">&quot;    data#{id} [label=\&quot;&#39;#{data}&#39;\&quot; shape=plaintext]\n&quot;</span>
      <span class="nx">dot</span> <span class="o">+=</span> <span class="s2">&quot;    data#{id} -&gt; #{cleanID(initializer.to.node)}[headlabel=#{cleanPort(initializer.to.port)} labelfontcolor=blue labelfontsize=8.0]\n&quot;</span>

    <span class="k">for</span> <span class="nx">edge</span> <span class="k">in</span> <span class="err">@</span><span class="nx">edges</span>
      <span class="nx">dot</span> <span class="o">+=</span> <span class="s2">&quot;    #{cleanID(edge.from.node)} -&gt; #{cleanID(edge.to.node)}[taillabel=#{cleanPort(edge.from.port)} headlabel=#{cleanPort(edge.to.port)} labelfontcolor=blue labelfontsize=8.0]\n&quot;</span>

    <span class="nx">dot</span> <span class="o">+=</span> <span class="s2">&quot;}&quot;</span>

    <span class="k">return</span> <span class="nx">dot</span>

  <span class="nv">toYUML: </span><span class="o">-&gt;</span>
    <span class="nx">yuml</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="nx">initializer</span> <span class="k">in</span> <span class="err">@</span><span class="nx">initializers</span>
      <span class="nx">yuml</span><span class="p">.</span><span class="nx">push</span> <span class="s2">&quot;(start)[#{initializer.to.port}]-&gt;(#{initializer.to.node})&quot;</span>

    <span class="k">for</span> <span class="nx">edge</span> <span class="k">in</span> <span class="err">@</span><span class="nx">edges</span>
      <span class="nx">yuml</span><span class="p">.</span><span class="nx">push</span> <span class="s2">&quot;(#{edge.from.node})[#{edge.from.port}]-&gt;(#{edge.to.node})&quot;</span>
    <span class="nx">yuml</span><span class="p">.</span><span class="nx">join</span> <span class="s2">&quot;,&quot;</span>

  <span class="nv">toJSON: </span><span class="o">-&gt;</span>
    <span class="nx">json</span> <span class="o">=</span>
      <span class="nv">properties: </span><span class="p">{}</span>
      <span class="nv">inports: </span><span class="p">{}</span>
      <span class="nv">outports: </span><span class="p">{}</span>
      <span class="nv">groups: </span><span class="p">[]</span>
      <span class="nv">processes: </span><span class="p">{}</span>
      <span class="nv">connections: </span><span class="p">[]</span>

    <span class="nx">json</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="err">@</span><span class="nx">name</span> <span class="k">if</span> <span class="err">@</span><span class="nx">name</span>
    <span class="k">for</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="err">@</span><span class="nx">properties</span>
      <span class="nx">json</span><span class="p">.</span><span class="nx">properties</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>

    <span class="k">for</span> <span class="nx">pub</span><span class="p">,</span> <span class="nx">priv</span> <span class="k">of</span> <span class="err">@</span><span class="nx">inports</span>
      <span class="nx">json</span><span class="p">.</span><span class="nx">inports</span><span class="p">[</span><span class="nx">pub</span><span class="p">]</span> <span class="o">=</span> <span class="nx">priv</span>
    <span class="k">for</span> <span class="nx">pub</span><span class="p">,</span> <span class="nx">priv</span> <span class="k">of</span> <span class="err">@</span><span class="nx">outports</span>
      <span class="nx">json</span><span class="p">.</span><span class="nx">outports</span><span class="p">[</span><span class="nx">pub</span><span class="p">]</span> <span class="o">=</span> <span class="nx">priv</span></pre></div>                                                  <p>Legacy exported ports</p>                            <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">exported</span> <span class="k">in</span> <span class="err">@</span><span class="nx">exports</span>
      <span class="nx">json</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">[]</span> <span class="nx">unless</span> <span class="nx">json</span><span class="p">.</span><span class="nx">exports</span>
      <span class="nx">json</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">push</span> <span class="nx">exported</span>

    <span class="k">for</span> <span class="nx">group</span> <span class="k">in</span> <span class="err">@</span><span class="nx">groups</span>
      <span class="nx">groupData</span> <span class="o">=</span>
        <span class="nv">name: </span><span class="nx">group</span><span class="p">.</span><span class="nx">name</span>
        <span class="nv">nodes: </span><span class="nx">group</span><span class="p">.</span><span class="nx">nodes</span>
      <span class="k">if</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">group</span><span class="p">.</span><span class="nx">metadata</span><span class="p">).</span><span class="nx">length</span>
        <span class="nx">groupData</span><span class="p">.</span><span class="nx">metadata</span> <span class="o">=</span> <span class="nx">group</span><span class="p">.</span><span class="nx">metadata</span>
      <span class="nx">json</span><span class="p">.</span><span class="nx">groups</span><span class="p">.</span><span class="nx">push</span> <span class="nx">groupData</span>

    <span class="k">for</span> <span class="nx">node</span> <span class="k">in</span> <span class="err">@</span><span class="nx">nodes</span>
      <span class="nx">json</span><span class="p">.</span><span class="nx">processes</span><span class="p">[</span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span>
        <span class="nv">component: </span><span class="nx">node</span><span class="p">.</span><span class="nx">component</span>
      <span class="k">if</span> <span class="nx">node</span><span class="p">.</span><span class="nx">metadata</span>
        <span class="nx">json</span><span class="p">.</span><span class="nx">processes</span><span class="p">[</span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">metadata</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">metadata</span>

    <span class="k">for</span> <span class="nx">edge</span> <span class="k">in</span> <span class="err">@</span><span class="nx">edges</span>
      <span class="nx">connection</span> <span class="o">=</span>
        <span class="nv">src:</span>
          <span class="nv">process: </span><span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">node</span>
          <span class="nv">port: </span><span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">port</span>
          <span class="nv">index: </span><span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">index</span>
        <span class="nv">tgt:</span>
          <span class="nv">process: </span><span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span>
          <span class="nv">port: </span><span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">port</span>
          <span class="nv">index: </span><span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">index</span>
      <span class="nx">connection</span><span class="p">.</span><span class="nx">metadata</span> <span class="o">=</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">metadata</span> <span class="k">if</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">edge</span><span class="p">.</span><span class="nx">metadata</span><span class="p">).</span><span class="nx">length</span>
      <span class="nx">json</span><span class="p">.</span><span class="nx">connections</span><span class="p">.</span><span class="nx">push</span> <span class="nx">connection</span>

    <span class="k">for</span> <span class="nx">initializer</span> <span class="k">in</span> <span class="err">@</span><span class="nx">initializers</span>
      <span class="nx">json</span><span class="p">.</span><span class="nx">connections</span><span class="p">.</span><span class="nx">push</span>
        <span class="nv">data: </span><span class="nx">initializer</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">data</span>
        <span class="nv">tgt:</span>
          <span class="nv">process: </span><span class="nx">initializer</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span>
          <span class="nv">port: </span><span class="nx">initializer</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">port</span>
          <span class="nv">index: </span><span class="nx">initializer</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">index</span>

    <span class="nx">json</span>

  <span class="nv">save: </span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">json</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span> <span class="err">@</span><span class="nx">toJSON</span><span class="p">(),</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">4</span>
    <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">).</span><span class="nx">writeFile</span> <span class="s2">&quot;#{file}.json&quot;</span><span class="p">,</span> <span class="nx">json</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">-&gt;</span>
      <span class="k">throw</span> <span class="nx">err</span> <span class="k">if</span> <span class="nx">err</span>
      <span class="nx">callback</span> <span class="nx">file</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">Graph</span> <span class="o">=</span> <span class="nx">Graph</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">createGraph</span> <span class="o">=</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">new</span> <span class="nx">Graph</span> <span class="nx">name</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">loadJSON</span> <span class="o">=</span> <span class="p">(</span><span class="nx">definition</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">metadata</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">-&gt;</span>
  <span class="nx">definition</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span> <span class="nx">definition</span> <span class="k">if</span> <span class="k">typeof</span> <span class="nx">definition</span> <span class="o">is</span> <span class="s1">&#39;string&#39;</span>
  <span class="nx">definition</span><span class="p">.</span><span class="nx">properties</span> <span class="o">=</span> <span class="p">{}</span> <span class="nx">unless</span> <span class="nx">definition</span><span class="p">.</span><span class="nx">properties</span>
  <span class="nx">definition</span><span class="p">.</span><span class="nx">processes</span> <span class="o">=</span> <span class="p">{}</span> <span class="nx">unless</span> <span class="nx">definition</span><span class="p">.</span><span class="nx">processes</span>
  <span class="nx">definition</span><span class="p">.</span><span class="nx">connections</span> <span class="o">=</span> <span class="p">[]</span> <span class="nx">unless</span> <span class="nx">definition</span><span class="p">.</span><span class="nx">connections</span>

  <span class="nx">graph</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Graph</span> <span class="nx">definition</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">name</span>

  <span class="nx">graph</span><span class="p">.</span><span class="nx">startTransaction</span> <span class="s1">&#39;loadJSON&#39;</span><span class="p">,</span> <span class="nx">metadata</span>
  <span class="nx">properties</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="k">for</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">definition</span><span class="p">.</span><span class="nx">properties</span>
    <span class="k">continue</span> <span class="k">if</span> <span class="nx">property</span> <span class="o">is</span> <span class="s1">&#39;name&#39;</span>
    <span class="nx">properties</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
  <span class="nx">graph</span><span class="p">.</span><span class="nx">setProperties</span> <span class="nx">properties</span>

  <span class="k">for</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">def</span> <span class="k">of</span> <span class="nx">definition</span><span class="p">.</span><span class="nx">processes</span>
    <span class="nx">def</span><span class="p">.</span><span class="nx">metadata</span> <span class="o">=</span> <span class="p">{}</span> <span class="nx">unless</span> <span class="nx">def</span><span class="p">.</span><span class="nx">metadata</span>
    <span class="nx">graph</span><span class="p">.</span><span class="nx">addNode</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">def</span><span class="p">.</span><span class="nx">component</span><span class="p">,</span> <span class="nx">def</span><span class="p">.</span><span class="nx">metadata</span>

  <span class="k">for</span> <span class="nx">conn</span> <span class="k">in</span> <span class="nx">definition</span><span class="p">.</span><span class="nx">connections</span>
    <span class="nx">metadata</span> <span class="o">=</span> <span class="k">if</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">metadata</span> <span class="k">then</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">metadata</span> <span class="k">else</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">data</span> <span class="o">isnt</span> <span class="kc">undefined</span>
      <span class="k">if</span> <span class="k">typeof</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">tgt</span><span class="p">.</span><span class="nx">index</span> <span class="o">is</span> <span class="s1">&#39;number&#39;</span>
        <span class="nx">graph</span><span class="p">.</span><span class="nx">addInitialIndex</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">tgt</span><span class="p">.</span><span class="nx">process</span><span class="p">,</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">tgt</span><span class="p">.</span><span class="nx">port</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">tgt</span><span class="p">.</span><span class="nx">index</span><span class="p">,</span> <span class="nx">metadata</span>
      <span class="k">else</span>
        <span class="nx">graph</span><span class="p">.</span><span class="nx">addInitial</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">tgt</span><span class="p">.</span><span class="nx">process</span><span class="p">,</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">tgt</span><span class="p">.</span><span class="nx">port</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span> <span class="nx">metadata</span>
      <span class="k">continue</span>
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">src</span><span class="p">.</span><span class="nx">index</span> <span class="o">is</span> <span class="s1">&#39;number&#39;</span> <span class="o">or</span> <span class="k">typeof</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">tgt</span><span class="p">.</span><span class="nx">index</span> <span class="o">is</span> <span class="s1">&#39;number&#39;</span>
      <span class="nx">graph</span><span class="p">.</span><span class="nx">addEdgeIndex</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">src</span><span class="p">.</span><span class="nx">process</span><span class="p">,</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">src</span><span class="p">.</span><span class="nx">port</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">src</span><span class="p">.</span><span class="nx">index</span><span class="p">,</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">tgt</span><span class="p">.</span><span class="nx">process</span><span class="p">,</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">tgt</span><span class="p">.</span><span class="nx">port</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">tgt</span><span class="p">.</span><span class="nx">index</span><span class="p">,</span> <span class="nx">metadata</span>
      <span class="k">continue</span>
    <span class="nx">graph</span><span class="p">.</span><span class="nx">addEdge</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">src</span><span class="p">.</span><span class="nx">process</span><span class="p">,</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">src</span><span class="p">.</span><span class="nx">port</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">tgt</span><span class="p">.</span><span class="nx">process</span><span class="p">,</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">tgt</span><span class="p">.</span><span class="nx">port</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span> <span class="nx">metadata</span>

  <span class="k">if</span> <span class="nx">definition</span><span class="p">.</span><span class="nx">exports</span> <span class="o">and</span> <span class="nx">definition</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">length</span>
    <span class="k">for</span> <span class="nx">exported</span> <span class="k">in</span> <span class="nx">definition</span><span class="p">.</span><span class="nx">exports</span>
      <span class="k">if</span> <span class="nx">exported</span><span class="p">.</span><span class="nx">private</span></pre></div>                                                  <p>Translate legacy ports to new</p>                            <div class="highlight"><pre>        <span class="nx">split</span> <span class="o">=</span> <span class="nx">exported</span><span class="p">.</span><span class="nx">private</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">continue</span> <span class="nx">unless</span> <span class="nx">split</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">2</span>
        <span class="nx">processId</span> <span class="o">=</span> <span class="nx">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nx">portId</span> <span class="o">=</span> <span class="nx">split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></pre></div>                                                  <p>Get properly cased process id</p>                            <div class="highlight"><pre>        <span class="k">for</span> <span class="nx">id</span> <span class="k">of</span> <span class="nx">definition</span><span class="p">.</span><span class="nx">processes</span>
          <span class="k">if</span> <span class="nx">id</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">is</span> <span class="nx">processId</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
            <span class="nx">processId</span> <span class="o">=</span> <span class="nx">id</span>
      <span class="k">else</span>
        <span class="nx">processId</span> <span class="o">=</span> <span class="nx">exported</span><span class="p">.</span><span class="nx">process</span>
        <span class="nx">portId</span> <span class="o">=</span> <span class="nx">exported</span><span class="p">.</span><span class="nx">port</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
      <span class="nx">graph</span><span class="p">.</span><span class="nx">addExport</span> <span class="nx">exported</span><span class="p">.</span><span class="nx">public</span><span class="p">,</span> <span class="nx">processId</span><span class="p">,</span> <span class="nx">portId</span><span class="p">,</span> <span class="nx">exported</span><span class="p">.</span><span class="nx">metadata</span>

  <span class="k">if</span> <span class="nx">definition</span><span class="p">.</span><span class="nx">inports</span>
    <span class="k">for</span> <span class="nx">pub</span><span class="p">,</span> <span class="nx">priv</span> <span class="k">of</span> <span class="nx">definition</span><span class="p">.</span><span class="nx">inports</span>
      <span class="nx">graph</span><span class="p">.</span><span class="nx">addInport</span> <span class="nx">pub</span><span class="p">,</span> <span class="nx">priv</span><span class="p">.</span><span class="nx">process</span><span class="p">,</span> <span class="nx">priv</span><span class="p">.</span><span class="nx">port</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span> <span class="nx">priv</span><span class="p">.</span><span class="nx">metadata</span>
  <span class="k">if</span> <span class="nx">definition</span><span class="p">.</span><span class="nx">outports</span>
    <span class="k">for</span> <span class="nx">pub</span><span class="p">,</span> <span class="nx">priv</span> <span class="k">of</span> <span class="nx">definition</span><span class="p">.</span><span class="nx">outports</span>
      <span class="nx">graph</span><span class="p">.</span><span class="nx">addOutport</span> <span class="nx">pub</span><span class="p">,</span> <span class="nx">priv</span><span class="p">.</span><span class="nx">process</span><span class="p">,</span> <span class="nx">priv</span><span class="p">.</span><span class="nx">port</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span> <span class="nx">priv</span><span class="p">.</span><span class="nx">metadata</span>

  <span class="k">if</span> <span class="nx">definition</span><span class="p">.</span><span class="nx">groups</span>
    <span class="k">for</span> <span class="nx">group</span> <span class="k">in</span> <span class="nx">definition</span><span class="p">.</span><span class="nx">groups</span>
      <span class="nx">graph</span><span class="p">.</span><span class="nx">addGroup</span> <span class="nx">group</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">group</span><span class="p">.</span><span class="nx">nodes</span><span class="p">,</span> <span class="nx">group</span><span class="p">.</span><span class="nx">metadata</span> <span class="o">||</span> <span class="p">{}</span>

  <span class="nx">graph</span><span class="p">.</span><span class="nx">endTransaction</span> <span class="s1">&#39;loadJSON&#39;</span>

  <span class="nx">callback</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">graph</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">loadFBP</span> <span class="o">=</span> <span class="p">(</span><span class="nx">fbpData</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">try</span>
    <span class="nx">definition</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fbp&#39;</span><span class="p">).</span><span class="nx">parse</span> <span class="nx">fbpData</span>
  <span class="k">catch</span> <span class="nx">e</span>
    <span class="k">return</span> <span class="nx">callback</span> <span class="nx">e</span>
  <span class="nx">exports</span><span class="p">.</span><span class="nx">loadJSON</span> <span class="nx">definition</span><span class="p">,</span> <span class="nx">callback</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">loadHTTP</span> <span class="o">=</span> <span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">req</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span>
  <span class="nx">req</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="o">-&gt;</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">req</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">is</span> <span class="mi">4</span>
    <span class="nx">unless</span> <span class="nx">req</span><span class="p">.</span><span class="nx">status</span> <span class="o">is</span> <span class="mi">200</span>
      <span class="k">return</span> <span class="nx">callback</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s2">&quot;Failed to load #{url}: HTTP #{req.status}&quot;</span>
    <span class="nx">callback</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">responseText</span>
  <span class="nx">req</span><span class="p">.</span><span class="nx">open</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">true</span>
  <span class="nx">req</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">loadFile</span> <span class="o">=</span> <span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">metadata</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">-&gt;</span>
  <span class="k">if</span> <span class="nx">platform</span><span class="p">.</span><span class="nx">isBrowser</span><span class="p">()</span>
    <span class="k">try</span></pre></div>                                                  <p>Graph exposed via Component packaging</p>                            <div class="highlight"><pre>      <span class="nx">definition</span> <span class="o">=</span> <span class="nx">require</span> <span class="nx">file</span>
    <span class="k">catch</span> <span class="nx">e</span></pre></div>                                                  <p>Graph available via HTTP</p>                            <div class="highlight"><pre>      <span class="nx">exports</span><span class="p">.</span><span class="nx">loadHTTP</span> <span class="nx">file</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">-&gt;</span>
        <span class="k">return</span> <span class="nx">callback</span> <span class="nx">err</span> <span class="k">if</span> <span class="nx">err</span>
        <span class="k">if</span> <span class="nx">file</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">).</span><span class="nx">pop</span><span class="p">()</span> <span class="o">is</span> <span class="s1">&#39;fbp&#39;</span>
          <span class="k">return</span> <span class="nx">exports</span><span class="p">.</span><span class="nx">loadFBP</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">metadata</span>
        <span class="nx">definition</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span> <span class="nx">data</span>
        <span class="nx">exports</span><span class="p">.</span><span class="nx">loadJSON</span> <span class="nx">definition</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">metadata</span>
      <span class="k">return</span>
    <span class="nx">exports</span><span class="p">.</span><span class="nx">loadJSON</span> <span class="nx">definition</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">metadata</span>
    <span class="k">return</span></pre></div>                                                  <p>Node.js graph file</p>                            <div class="highlight"><pre>  <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">).</span><span class="nx">readFile</span> <span class="nx">file</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">return</span> <span class="nx">callback</span> <span class="nx">err</span> <span class="k">if</span> <span class="nx">err</span>

    <span class="k">if</span> <span class="nx">file</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">).</span><span class="nx">pop</span><span class="p">()</span> <span class="o">is</span> <span class="s1">&#39;fbp&#39;</span>
      <span class="k">return</span> <span class="nx">exports</span><span class="p">.</span><span class="nx">loadFBP</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">callback</span>

    <span class="nx">definition</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span> <span class="nx">data</span>
    <span class="nx">exports</span><span class="p">.</span><span class="nx">loadJSON</span> <span class="nx">definition</span><span class="p">,</span> <span class="nx">callback</span></pre></div>                                                  <p>remove everything in the graph</p>                            <div class="highlight"><pre><span class="nx">resetGraph</span> <span class="o">=</span> <span class="p">(</span><span class="nx">graph</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>                                                  <p>Edges and similar first, to have control over the order
If we'd do nodes first, it will implicitly delete edges
Important to make journal transactions invertible</p>                            <div class="highlight"><pre>  <span class="k">for</span> <span class="nx">group</span> <span class="k">in</span> <span class="p">(</span><span class="nx">clone</span> <span class="nx">graph</span><span class="p">.</span><span class="nx">groups</span><span class="p">).</span><span class="nx">reverse</span><span class="p">()</span>
    <span class="nx">graph</span><span class="p">.</span><span class="nx">removeGroup</span> <span class="nx">group</span><span class="p">.</span><span class="nx">name</span> <span class="k">if</span> <span class="nx">group</span><span class="o">?</span>
  <span class="k">for</span> <span class="nx">port</span><span class="p">,</span> <span class="nx">v</span> <span class="k">of</span> <span class="nx">clone</span> <span class="nx">graph</span><span class="p">.</span><span class="nx">outports</span>
    <span class="nx">graph</span><span class="p">.</span><span class="nx">removeOutport</span> <span class="nx">port</span>
  <span class="k">for</span> <span class="nx">port</span><span class="p">,</span> <span class="nx">v</span> <span class="k">of</span> <span class="nx">clone</span> <span class="nx">graph</span><span class="p">.</span><span class="nx">inports</span>
    <span class="nx">graph</span><span class="p">.</span><span class="nx">removeInport</span> <span class="nx">port</span>
  <span class="k">for</span> <span class="nx">exp</span> <span class="k">in</span> <span class="nx">clone</span> <span class="p">(</span><span class="nx">graph</span><span class="p">.</span><span class="nx">exports</span><span class="p">).</span><span class="nx">reverse</span><span class="p">()</span>
    <span class="nx">graph</span><span class="p">.</span><span class="nx">removeExport</span> <span class="nx">exp</span><span class="p">.</span><span class="nx">public</span></pre></div>                                                  <p>XXX: does this actually null the props??</p>                            <div class="highlight"><pre>  <span class="nx">graph</span><span class="p">.</span><span class="nx">setProperties</span> <span class="p">{}</span>
  <span class="k">for</span> <span class="nx">iip</span> <span class="k">in</span> <span class="p">(</span><span class="nx">clone</span> <span class="nx">graph</span><span class="p">.</span><span class="nx">initializers</span><span class="p">).</span><span class="nx">reverse</span><span class="p">()</span>
    <span class="nx">graph</span><span class="p">.</span><span class="nx">removeInitial</span> <span class="nx">iip</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">iip</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">port</span>
  <span class="k">for</span> <span class="nx">edge</span> <span class="k">in</span> <span class="p">(</span><span class="nx">clone</span> <span class="nx">graph</span><span class="p">.</span><span class="nx">edges</span><span class="p">).</span><span class="nx">reverse</span><span class="p">()</span>
    <span class="nx">graph</span><span class="p">.</span><span class="nx">removeEdge</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">port</span><span class="p">,</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">port</span>
  <span class="k">for</span> <span class="nx">node</span> <span class="k">in</span> <span class="p">(</span><span class="nx">clone</span> <span class="nx">graph</span><span class="p">.</span><span class="nx">nodes</span><span class="p">).</span><span class="nx">reverse</span><span class="p">()</span>
    <span class="nx">graph</span><span class="p">.</span><span class="nx">removeNode</span> <span class="nx">node</span><span class="p">.</span><span class="nx">id</span></pre></div>                                                  <p>Note: Caller should create transaction
First removes everything in @base, before building it up to mirror @to</p>                            <div class="highlight"><pre><span class="nx">mergeResolveTheirsNaive</span> <span class="o">=</span> <span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">to</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">resetGraph</span> <span class="nx">base</span>

  <span class="k">for</span> <span class="nx">node</span> <span class="k">in</span> <span class="nx">to</span><span class="p">.</span><span class="nx">nodes</span>
    <span class="nx">base</span><span class="p">.</span><span class="nx">addNode</span> <span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">component</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">metadata</span>
  <span class="k">for</span> <span class="nx">edge</span> <span class="k">in</span> <span class="nx">to</span><span class="p">.</span><span class="nx">edges</span>
    <span class="nx">base</span><span class="p">.</span><span class="nx">addEdge</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">port</span><span class="p">,</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">port</span><span class="p">,</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">metadata</span>
  <span class="k">for</span> <span class="nx">iip</span> <span class="k">in</span> <span class="nx">to</span><span class="p">.</span><span class="nx">initializers</span>
    <span class="nx">base</span><span class="p">.</span><span class="nx">addInitial</span> <span class="nx">iip</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="nx">iip</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">iip</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">port</span><span class="p">,</span> <span class="nx">iip</span><span class="p">.</span><span class="nx">metadata</span>
  <span class="k">for</span> <span class="nx">exp</span> <span class="k">in</span> <span class="nx">to</span><span class="p">.</span><span class="nx">exports</span>
    <span class="nx">base</span><span class="p">.</span><span class="nx">addExport</span> <span class="nx">exp</span><span class="p">.</span><span class="nx">public</span><span class="p">,</span> <span class="nx">exp</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">exp</span><span class="p">.</span><span class="nx">port</span><span class="p">,</span> <span class="nx">exp</span><span class="p">.</span><span class="nx">metadata</span>
  <span class="nx">base</span><span class="p">.</span><span class="nx">setProperties</span> <span class="nx">to</span><span class="p">.</span><span class="nx">properties</span>
  <span class="k">for</span> <span class="nx">pub</span><span class="p">,</span> <span class="nx">priv</span> <span class="k">of</span> <span class="nx">to</span><span class="p">.</span><span class="nx">inports</span>
    <span class="nx">base</span><span class="p">.</span><span class="nx">addInport</span> <span class="nx">pub</span><span class="p">,</span> <span class="nx">priv</span><span class="p">.</span><span class="nx">process</span><span class="p">,</span> <span class="nx">priv</span><span class="p">.</span><span class="nx">port</span><span class="p">,</span> <span class="nx">priv</span><span class="p">.</span><span class="nx">metadata</span>
  <span class="k">for</span> <span class="nx">pub</span><span class="p">,</span> <span class="nx">priv</span> <span class="k">of</span> <span class="nx">to</span><span class="p">.</span><span class="nx">outports</span>
    <span class="nx">base</span><span class="p">.</span><span class="nx">addOutport</span> <span class="nx">pub</span><span class="p">,</span> <span class="nx">priv</span><span class="p">.</span><span class="nx">process</span><span class="p">,</span> <span class="nx">priv</span><span class="p">.</span><span class="nx">port</span><span class="p">,</span> <span class="nx">priv</span><span class="p">.</span><span class="nx">metadata</span>
  <span class="k">for</span> <span class="nx">group</span> <span class="k">in</span> <span class="nx">to</span><span class="p">.</span><span class="nx">groups</span>
    <span class="nx">base</span><span class="p">.</span><span class="nx">addGroup</span> <span class="nx">group</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">group</span><span class="p">.</span><span class="nx">nodes</span><span class="p">,</span> <span class="nx">group</span><span class="p">.</span><span class="nx">metadata</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">equivalent</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">-&gt;</span></pre></div>                                                  <p>TODO: add option to only compare known fields
TODO: add option to ignore metadata</p>                            <div class="highlight"><pre>  <span class="nx">A</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span> <span class="nx">a</span>
  <span class="nx">B</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span> <span class="nx">b</span>
  <span class="k">return</span> <span class="nx">A</span> <span class="o">==</span> <span class="nx">B</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">mergeResolveTheirs</span> <span class="o">=</span> <span class="nx">mergeResolveTheirsNaive</span>

</pre></div>                                   <p><small>This page contains documentation generated automatically on 2016-03-29 from NoFlo's <a href="https://github.com/noflo/noflo/blob/master/src/lib/Graph.coffee">Graph.coffee</a> file.</small></p>         </div>       </div>     </div>   </div> 